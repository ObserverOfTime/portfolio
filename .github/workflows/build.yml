name: Build & deploy portfolio

on:
  push:
    branches-ignore: ['gh-pages']
  pull_request:
    branches-ignore: ['gh-pages']

jobs:
  build:
    if: |
      contains(github.event.commits[0].message, '[skip ci]') == false &&
      contains(github.event.commits[0].message, '[ci skip]') == false
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - uses: Borales/actions-yarn@v2.1.0
      - name: Install package with yarn
        run: yarn --frozen-lockfile
      - name: Lint code with eslint & stylelint
        run: yarn lint:js && yarn lint:css
      - name: Export static site with sapper
        run: yarn export
      - name: Deploy site to GitHub pages
        if: success() && github.ref == 'refs/heads/master'
        uses: alex-page/blazing-fast-gh-pages-deploy@v1.1.0
        with:
          repo-token: ${{secrets.GITHUB_PAT}}
          site-directory: __sapper__/export/portfolio
